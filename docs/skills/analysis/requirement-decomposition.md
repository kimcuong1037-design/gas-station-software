# Skill: 需求拆解 (Requirement Decomposition)

## 元信息

- **Skill ID:** `requirement-decomposition`
- **所属 Agent:** 需求分析 Agent (Requirement Analyst)
- **输入：**
  - 目标模块名称（如"基础运营 > 站点管理"）
  - 需求文档路径（`requirements/加气站运营管理系统-功能清单-参考.md`）
  - 术语规范（`docs/STANDARDS.md` §1 术语表）
  - ROADMAP 中该模块的范围定义（`docs/ROADMAP.md`）
- **输出：**
  - 模块需求拆解文档（存放于 `docs/features/<domain>/<module>/requirements.md`）
  - 需要确认的疑问清单
- **依赖：** 无（本 Skill 是开发流程的起点）

---

## 拆解颗粒度定义

需求拆解必须遵循以下层级结构，从粗到细：

| 层级 | 名称 | 说明 | 示例 |
|------|------|------|------|
| L1 | **子系统** | 按业务域划分的顶层分组，对应需求文档"二、功能清单"中的一级标题 | 基础运营、能源交易、会员与大客户 |
| L2 | **功能模块** | 子系统下的独立业务模块，对应需求文档中的二级标题（如 1.1、1.2） | 站点管理、交接班管理、设备设施管理 |
| L3 | **功能** | 功能模块下的具体业务功能，对应需求文档表格中的"二级功能"列 | 站点基础信息管理、加注机/枪配置、员工与排班 |
| L4 | **功能点（原子功能）** | 功能下的最小可交付单元，每个功能点对应一个清晰、特定、明确的操作，可用一个测试用例验收 | 新增站点、编辑站点信息、查看站点列表、删除站点 |

**层级对应关系示例：**

```
L1 子系统：基础运营
└── L2 功能模块：站点管理 (1.1)
    ├── L3 功能：站点基础信息
    │   ├── L4 功能点：查看站点列表（支持搜索、筛选）
    │   ├── L4 功能点：新增站点（填写名称、编码、地址、经纬度、联系方式、营业时间）
    │   ├── L4 功能点：编辑站点信息
    │   ├── L4 功能点：查看站点详情
    │   └── L4 功能点：多站点切换
    ├── L3 功能：加注机/枪配置
    │   ├── L4 功能点：查看枪号列表及状态
    │   ├── L4 功能点：配置枪号与燃料类型绑定
    │   └── L4 功能点：设置枪单价
    └── L3 功能：员工与排班
        ├── L4 功能点：...
        └── ...
```

**拆解原则：**

1. **忠实拆分：** 只能基于需求文档中已有的信息进行拆解，不得发挥、臆造或添加需求文档中不存在的功能
2. **适度颗粒度：** 功能点（L4）应是"可用一个测试用例验收"的粒度，不要过细（如"点击保存按钮"不是功能点），也不要过粗（如"站点管理"不是功能点）
3. **可验收性：** 每个功能点必须能回答"做完了如何验证？"这个问题
4. **独立性：** 每个功能点应尽量独立，减少与其他功能点的耦合
5. **功能点是 User Story 的输入：** 拆分出的 L3 功能和 L4 功能点，将直接作为后续 `user-story-writing` Skill 的基本输入

---

## 流程定义

### 步骤 1: 定位需求范围

从需求文档中定位目标模块对应的章节：
- 需求文档按"二、功能清单（按业务域）"组织，对应 L1 子系统和 L2 功能模块
- 每个功能模块（L2）包含若干"二级功能"（对应 L3 功能），每个功能有"功能点"和"说明与补充"
- 同时检查需求文档其他章节（如系统架构、POS 端、移动端）中是否有与该模块相关的补充描述

### 步骤 2: 提取功能清单并拆解为功能点

将需求文档中的表格内容，按 L3 功能 → L4 功能点的层级进行结构化拆解：
- 保留原始的 L3 功能分组（对应需求文档表格中的"二级功能"列）
- 对每个 L3 功能，从"功能点"和"说明与补充"列中提取并拆解为 L4 功能点（原子功能）
- 每个 L4 功能点记录：功能点名称、功能描述、来源说明
- 标注功能点的来源位置（需求文档行号或章节）
- **严格遵守拆解原则：** 只做忠实拆分，不添加需求文档中不存在的信息

### 步骤 3: 功能点分类与优先级标注

对每个功能点进行分类：

| 分类 | 标记 | 说明 |
|------|------|------|
| MVP 核心 | `[MVP]` | 演示原型必须包含的功能 |
| MVP 增强 | `[MVP+]` | 演示中有则更好，可简化实现 |
| 生产必需 | `[PROD]` | 生产环境必须，演示阶段可跳过 |
| 远期规划 | `[FUTURE]` | 远期功能，当前阶段不考虑 |

分类依据：
- 该功能是否在 ROADMAP.md 的"关键页面/功能"中被提及 → 倾向 `[MVP]`
- 该功能是否涉及硬件对接、第三方集成 → 倾向 `[PROD]` 或 `[FUTURE]`
- 该功能是否为管理后台可展示的 UI 功能 → 倾向 `[MVP]` 或 `[MVP+]`

### 步骤 4: 识别功能间依赖关系

分析功能点之间的依赖：
- 数据依赖：功能 A 的数据是功能 B 的输入
- 流程依赖：功能 A 必须在功能 B 之前完成
- 跨模块依赖：该模块的功能依赖其他模块的数据或能力

输出依赖关系图（文本描述）。

### 步骤 5: 提出疑问与确认项

列出需要与用户确认的问题：
- 需求文档中描述模糊的功能点
- 多种实现方式可选的功能点
- 与其他模块边界不清的功能点
- MVP 范围判断不确定的功能点

### 步骤 6: 输出需求拆解文档

按输出格式生成文档，存放到指定路径。

---

## Prompt 模板

```
你是需求分析 Agent，负责对加气站运营管理系统的指定模块进行需求拆解。

## 任务
对模块【{{MODULE_NAME}}】进行需求拆解。

## 输入文件
- 需求文档：requirements/加气站运营管理系统-功能清单-参考.md
  - 目标章节：{{SECTION_REFERENCE}}
- 术语规范：docs/STANDARDS.md §1 术语表
- 模块范围：docs/ROADMAP.md 中【{{MODULE_NAME}}】的定义

## 执行步骤
请严格按照 docs/skills/analysis/requirement-decomposition.md 中定义的步骤 1-6 执行。

## 关键要求
1. 严格遵循拆解颗粒度定义（L1-L4 层级）
2. 只做忠实拆分，不发挥、不添加需求文档中不存在的功能
3. 所有术语必须与 STANDARDS.md 术语表一致
4. 功能点（L4）必须标注优先级分类：[MVP] / [MVP+] / [PROD] / [FUTURE]
5. 每个功能点（L4）必须是可用一个测试用例验收的原子功能
6. 必须识别跨模块依赖
7. 对不确定的内容，列入疑问清单而非自行假设

## 输出
将结果写入：docs/features/{{DOMAIN}}/{{MODULE}}/requirements.md
格式遵循本 Skill 文件中的"输出格式"规范。
```

---

## 输出格式

```markdown
# {{MODULE_NAME}} — 需求拆解

**模块：** {{MODULE_NAME}}
**需求来源：** requirements/加气站运营管理系统-功能清单-参考.md §{{SECTION}}
**拆解日期：** {{DATE}}
**状态：** 待确认 / 已确认

---

## 1. 功能拆解清单

### 1.1 {{L3 功能名称}}（来源：需求文档 §x.x 表格第 n 行）

**功能描述：** {{从需求文档提取的功能说明}}

| # | 功能点（L4 原子功能） | 描述 | 优先级 | 来源 |
|---|---------------------|------|--------|------|
| F001 | {{功能点名称}} | {{具体描述，可用一个测试用例验收}} | [MVP] | §x.x 行n |
| F002 | {{功能点名称}} | {{具体描述}} | [MVP+] | §x.x 行n |
| ... | | | | |

### 1.2 {{L3 功能名称}}（来源：需求文档 §x.x 表格第 n 行）

（同上格式）

---

## 2. 依赖关系

### 2.1 模块内依赖
- F001 → F003: {{说明}}

### 2.2 跨模块依赖
- F005 依赖【{{其他模块}}】的 {{具体能力}}: {{说明}}

---

## 3. 疑问与确认项

| # | 问题 | 涉及功能点 | 建议选项 |
|---|------|-----------|---------|
| Q1 | {{问题描述}} | F001, F002 | A: ... / B: ... |
| Q2 | {{问题描述}} | F005 | 需用户明确 |

---

## 4. MVP 范围汇总

| 优先级 | 数量 | 功能点编号 |
|--------|------|-----------|
| [MVP] | {{n}} | F001, F002, ... |
| [MVP+] | {{n}} | F003, ... |
| [PROD] | {{n}} | F006, ... |
| [FUTURE] | {{n}} | F008, ... |
```

---

## 检查清单

- [ ] 需求文档中该模块的所有 L3 功能均已覆盖
- [ ] 每个 L3 功能都已拆解为 L4 功能点（原子功能）
- [ ] 每个 L4 功能点都是可用一个测试用例验收的粒度
- [ ] 没有添加需求文档中不存在的功能（忠实拆分）
- [ ] 没有过细的拆分（如"点击按钮"不是功能点）
- [ ] 每个功能点都有明确的优先级标注
- [ ] 术语与 STANDARDS.md 一致
- [ ] 跨模块依赖已识别并记录
- [ ] 疑问清单中无遗漏的模糊点
- [ ] 输出文件路径正确
- [ ] 功能点编号连续且唯一
